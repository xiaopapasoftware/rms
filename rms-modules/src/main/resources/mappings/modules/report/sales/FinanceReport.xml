<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.report.dao.ContractReportDao">

    <select id="queryFinance" resultType="java.util.Map" parameterType="com.thinkgem.jeesite.common.filter.search.Criterion">
        select tr.receipt_date,tr.receipt_amount,tpp.project_name,tb.building_name,th.house_no,tro.room_no
        from t_receipt tr
        left join t_trading_accounts tta on tr.trading_accounts_id = tta.id and tta.del_flag=0
        left join t_payment_trade tpt on tpt.trade_id = tta.id and tpt.del_flag=0
        left join t_payment_trans tpta on tpta.id = tpt.trans_id and tpta.del_flag=0
        left join t_rent_contract trc on tpta.trans_id = trc.id

        left join t_building tb on trc.building_id = tb.id and tb.del_flag =0
        left join t_property_project tpp on tb.t_property_project_main_id = tpp.id and tpp.del_flag =0
        left join t_house th on trc.house_id = th.id and th.del_flag =0
        left join t_room tro on trc.room_id = tro.id and tr.del_flag =0
        where tr.del_flag=0

        ${whereSqlString}
        <if test="orderBy != null">
            ${orderBySqlString}
        </if>

    </select>

    <!--查询账务信息以及票据的金额-->
    <select id="qeueryTrade"  resultType="java.util.Map" parameterType="com.thinkgem.jeesite.common.filter.search.Criterion">
        select tr.receipt_date,tr.receipt_amount,tr.trade_mode,tr.payment_type,
        tta.trade_type,tta.trade_direction,tta.trade_amount,tta.trade_status,
        tr.id,tta.id
        from t_receipt tr
        left join t_trading_accounts tta on tr.trading_accounts_id = tta.id and tta.del_flag=0
        where tr.del_flag=0
        ${whereSqlString}
        <if test="orderBy != null">
            ${orderBySqlString}
        </if>
    </select>

    <!--查询账务信息对应的合同信息以及房屋信息-->
    <select id="qeueryHouseInfo"  resultType="java.util.Map" parameterType="java.lang.String">
        select trc.id,tpp.project_name,tb.building_name,th.house_no,tro.room_no from t_rent_contract trc
        left join t_building tb on trc.building_id = tb.id and tb.del_flag =0
        left join t_property_project tpp on tb.t_property_project_main_id = tpp.id and tpp.del_flag =0
        left join t_house th on trc.house_id = th.id and th.del_flag =0
        left join t_room tro on trc.room_id = tro.id and tro.del_flag =0
        where trc.del_flag =0
        and exists(
        select distinct tpts.trans_id from t_payment_trans  tpts
        left join t_payment_trade tpt on tpt.trans_id = tpts.id and tpt.del_flag=0
        where trc.id=tpts.trans_id
        and tpt.trade_id = #{transId,jdbcType=VARCHAR} )
    </select>
</mapper>